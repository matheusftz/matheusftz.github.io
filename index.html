<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matheus Frantz Portfolio - Interactive</title>
    <style>
        /* CSS BÁSICO E LAYOUT */
        body { 
            font-family: 'Merriweather', serif; 
            margin: 0; 
            padding: 0; 
            color: #e0e0e0; 
            overflow-x: hidden; 
        }
        #game-background { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 0; 
            background-color: #121212; 
            background-image: url('https://www.transparenttextures.com/patterns/dark-denim.png'); 
            background-repeat: repeat; 
            background-attachment: fixed; 
        }
        
        .top-bar, footer { 
            pointer-events: none; 
        }
        .top-bar *, main *, footer * { 
            pointer-events: auto; 
        }

        .top-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 1.5rem 2rem; 
            background: rgba(10, 10, 10, 0.9); 
            font-family: 'Cinzel', serif; 
            font-weight: 700; 
            text-transform: uppercase; 
            font-size: 0.9rem; 
            border-bottom: 2px solid #b8860b; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
        }
        .top-bar .name { 
            font-size: 1.2rem; 
            letter-spacing: 0.15em; 
            color: #ffd700; 
        }
        .top-bar .nav-links a { 
            color: #e0e0e0; 
            text-decoration: none; 
            margin: 0 0.5rem; 
            transition: color 0.3s ease, text-shadow 0.3s ease; 
        }
        .top-bar .nav-links a:hover { 
            color: #ffd700; 
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); 
        }
        .top-bar .nav-links .separator { 
            color: #555; 
            margin: 0 0.2rem; 
        }
        
        main { 
            padding: 2rem; 
            max-width: 1200px; 
            margin: auto; 
            position: relative; 
            z-index: 10; 
        }
        .intro { 
            text-align: left; 
            margin-bottom: 4rem; 
            padding-top: 3rem; 
            padding-left: 1rem; 
            pointer-events: none; 
        }
        .intro h1 { 
            font-family: 'Cinzel', serif; 
            font-size: 3.8rem; 
            color: #e0e0e0; 
            margin-bottom: 0.8rem; 
            letter-spacing: 0.08em; 
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7); 
        }
        .intro p { 
            font-size: 1.2rem; 
            color: #ccc; 
            line-height: 1.6; 
        }
        
        .project-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 5.5rem; /* Valor padrão para telas maiores */
            margin-top: 2rem; 
        }

        /* Ajustes para telas menores (ex: <= 768px, um breakpoint comum para tablets/celulares) */
        @media (max-width: 768px) {
            .project-list {
                gap: 2rem; /* Reduz o espaçamento entre os cards em telas menores */
            }
        }

        /* Você pode adicionar outro breakpoint para telas ainda menores se necessário */
        @media (max-width: 480px) {
            .project-list {
                gap: 1.5rem; /* Mais espaçamento para telas de celular */
            }
            /* Ajusta o padding do main para dar mais respiro */
            main {
                padding: 1rem;
            }
        }
        
        .project { 
            background: #2a2a2a; 
            border-radius: 8px; 
            text-decoration: none; 
            color: inherit; 
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6), 0 0 8px rgba(255, 215, 0, 0.3); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            overflow: hidden; /* Keep this to clip content INSIDE the card, but sparkles will be outside */
            display: flex; 
            flex-direction: column; 
            border: 1px solid #555; 
        }
        .project img { 
            width: 100%; 
            height: 220px; 
            object-fit: cover; 
            display: block; 
            border-bottom: 3px solid #b8860b; 
        }
        .project h3 { 
            font-family: 'Cinzel', serif; 
            margin: 1.2rem 1.2rem 0.6rem 1.2rem; 
            color: #ffd700; 
            letter-spacing: 0.05em; 
        }
        .project p { 
            margin: 0 1.2rem 1.2rem 1.2rem; 
            color: #ccc; 
            font-size: 1rem; 
        }
        
        footer { 
            text-align: center; 
            padding: 2.5rem; 
            font-size: 0.9rem; 
            color: #888; 
            margin-top: 4rem; 
            border-top: 2px solid #3a3a3a; 
            background: rgba(10, 10, 10, 0.9); 
            position: relative; 
            z-index: 10; 
        }
        
        /* === ESTILOS PARA O JOGO ==== */
        :root {
            --pixel-coin: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACLSURBVDhPzZJBDsAgCAMT/f+nP6lDu9hWFoKHDqGHIk3SHIKH2gOAZ0bA1p70bQIqgBpgBWbUaKsh6sC+j5nI7Tpg0Vfgv0A2A5rQyAhGkMwA0wBIbAY1wBg0QFgI2XzAD6YhVgOAgA/j3kUDG/fJSOZE5vAw8L83S7wJgDtwK/5lAgA+GgAAwE/a/AEPKz+S7sUeIgAAAABJRU5ErkJggg==');
            
            --sparkle-spritesheet: url('images/sparkle_spritesheet.png'); /* Novo asset para brilhos/sparkles */

            --coin-sprite-sheet: url('images/coin_spritesheet.png');
            --coin-explosion-sheet: url('images/coin_explosion.png');
        }
        
        #bubble-container { 
            position: fixed; /* Mantenha fixed para que os sparkles flutuem sobre o conteúdo */
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 20; /* Garante que os sparkles estejam acima dos cards */
            pointer-events: none; 
        }
        
        /* Estilos para a moeda dourada (padrão) */
        .coin-sprite { 
            position: absolute; 
            pointer-events: auto; 
            cursor: pointer; 
            will-change: transform;
            width: 48px; /* Tamanho base das moedas douradas (48x48) */
            height: 48px; 
            background-image: var(--coin-sprite-sheet);
            background-size: 384px 48px; /* 8 frames * 48px */
            animation: spin-coin 0.8s steps(8) infinite;
            image-rendering: pixelated;
        }

.coin-sprite::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150%; /* Aumenta a largura da hitbox em 50% */
    height: 150%; /* Aumenta a altura da hitbox em 50% */
    transform: translate(-50%, -50%); /* Centraliza o pseudo-elemento */
    /* background-color: rgba(255, 0, 0, 0.2);  Descomente para visualizar a hitbox */
    pointer-events: auto; /* Garante que o pseudo-elemento também é clicável */
    z-index: 1; /* Garante que o pseudo-elemento está acima da imagem da moeda para clique */
}
        /* Estilos para a moeda cinza */
        .coin-sprite.gray {
            width: 72px; /* 48px * 1.5 = 72px (50% maior) */
            height: 72px;
            background-size: 576px 72px; /* 8 frames * 72px */
            filter: grayscale(100%); /* Transforma a moeda em cinza */
            animation: spin-coin-gray 0.8s steps(8) infinite; /* Animação específica para a moeda cinza */
        }

        /* NOVO: Estilos para a moeda Rainbow */
        .coin-sprite.rainbow {
            width: 60px; /* 48px * 1.25 = 60px (25% maior que a dourada) */
            height: 60px;
            background-size: 480px 60px; /* 8 frames * 60px */
            animation: spin-coin-rainbow 0.6s steps(8) infinite, hue-rotate 1s linear infinite; /* Mais rápida e muda de cor */
            filter: hue-rotate(0deg); /* Ponto de partida para a rotação de matiz */
        }


        @keyframes spin-coin {
            to { background-position-x: -384px; } /* Posição final da animação para moedas douradas */
        }

        /* Nova keyframe para moedas cinzas */
        @keyframes spin-coin-gray {
            to { background-position-x: -576px; } /* Posição final da animação para moedas cinzas (8 frames * 72px) */
        }
        
        /* NOVO: Keyframe para moedas Rainbow */
        @keyframes spin-coin-rainbow {
            to { background-position-x: -480px; } /* 8 frames * 60px */
        }

        /* NOVO: Keyframe para rotação de matiz (cor) */
        @keyframes hue-rotate {
            to { filter: hue-rotate(360deg); }
        }

        .sprite-explosion {
            position: absolute;
            width: 48px; /* Tamanho base da explosão da moeda dourada */
            height: 48px;
            background-image: var(--coin-explosion-sheet);
            background-size: 288px 48px; /* 6 frames * 48px */
            animation: explode-effect 0.6s steps(6) forwards;
            pointer-events: none;
            image-rendering: pixelated;
        }

        .sprite-explosion.gray {
            width: 72px; /* Tamanho da explosão da moeda cinza */
            height: 72px;
            background-size: 432px 72px; /* 6 frames * 72px */
            filter: grayscale(100%);
            animation: explode-effect-gray 0.6s steps(6) forwards; /* Animação específica para a explosão cinza */
        }

        /* NOVO: Estilo para explosão da moeda Rainbow */
        .sprite-explosion.rainbow {
            width: 60px; /* Tamanho da explosão da moeda rainbow */
            height: 60px;
            background-size: 360px 60px; /* 6 frames * 60px */
            filter: hue-rotate(0deg); /* Ponto de partida */
            animation: explode-effect-rainbow 0.6s steps(6) forwards, hue-rotate 0.6s linear forwards; /* Mantém a mudança de cor durante a explosão */
        }

        @keyframes explode-effect {
           to { background-position-x: -288px; }
        }

        @keyframes explode-effect-gray {
           to { background-position-x: -432px; } /* 6 frames * 72px */
        }

        /* NOVO: Keyframe para explosão Rainbow */
        @keyframes explode-effect-rainbow {
           to { background-position-x: -360px; } /* 6 frames * 60px */
        }

        /* Container para o saldo e os botões */
        #game-controls {
            position: fixed; 
            top: 100px; 
            right: 2rem; 
            z-index: 1001; 
            display: flex;
            flex-direction: column; /* Botões um abaixo do outro */
            gap: 10px; /* Espaçamento entre o saldo e os botões */
            pointer-events: none; /* Para não interferir com o jogo, mas os filhos são auto */
        }

        #coin-balance { 
            background: rgba(10, 10, 10, 0.9); 
            color: #ffd700; 
            padding: 0.5rem 1rem; 
            border-radius: 8px; 
            font-family: 'Press Start 2P', cursive; 
            font-size: 1.5rem; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            border: 2px solid #b8860b; 
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.6); 
            pointer-events: auto; 
        }
        .coin-icon { 
            display: inline-block; 
            width: 48px; 
            height: 48px; 
            background-image: var(--pixel-coin); 
            background-size: contain; 
            margin-right: 0.5rem; 
            image-rendering: pixelated; 
        }

        /* ESTILO PARA O TEXTO FLUTUANTE DE PONTUAÇÃO */
        .score-pop {
            position: absolute;
            color: #ffd700;
            font-family: 'Press Start 2P', cursive; 
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            opacity: 0;
            animation: score-fade-up 1s forwards;
            z-index: 25; 
        }

        /* Novo estilo para o pop-up de moedas do botão */
        .button-score-pop {
            position: absolute; /* Para posicionamento em relação ao botão */
            color: #ffd700;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            opacity: 0;
            animation: score-fade-up 1s forwards; /* Reutiliza a mesma animação */
            z-index: 1002; /* Acima de tudo */
        }

        /* NOVO: Estilo para o pop-up de erro */
        .error-pop {
            position: absolute;
            color: #ff4d4d; /* Vermelho para erro */
            font-family: 'Press Start 2P', cursive; 
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            opacity: 0;
            animation: error-fade-up 1s forwards; /* Animação própria */
            z-index: 25; 
            white-space: nowrap; /* Garante que o texto não quebre linha */
        }

        @keyframes score-fade-up {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px) scale(1.2);
                opacity: 0;
            }
        }

        /* NOVO: Animação para o pop-up de erro */
        @keyframes error-fade-up {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-30px) scale(1.1); /* Sobe menos que o score pop */
                opacity: 0;
            }
        }

        .project { position: relative; }

        /* Contêiner da moeda e preço (substitui o cadeado) */
        .project .project-lock { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.7); /* Overlay escuro */
            z-index: 2; 
            display: none; /* Escondido por padrão, mostrado quando .locked */
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            color: #ffd700; 
            font-family: 'Press Start 2P', cursive; /* Fonte do score */
            pointer-events: none; /* Permite que o JS do card manipule o clique */
        }

        /* Estilos do preço e da moeda girando */
        .project-cost { 
            font-size: 1.5rem; 
            font-weight: 700; 
            display: flex; 
            flex-direction: column; /* Moeda em cima, valor embaixo */
            align-items: center; /* Centraliza a moeda e o valor */
            color: #ffd700; /* Cor dourada para o preço */
        }
        .project-cost::before { 
            content: ''; 
            display: block; /* Mude para block para ficar acima do texto */
            width: 48px; 
            height: 48px; 
            background-image: var(--coin-sprite-sheet); /* Usa o spritesheet da moeda */
            background-size: 384px 48px; /* 8 frames * 48px */
            animation: spin-coin 0.8s steps(8) infinite; /* Animação de giro */
            image-rendering: pixelated; 
            margin-bottom: 0.5rem; /* Espaçamento entre moeda e valor */
        }

        /* Estilos para o estado 'locked' do projeto */
        .project.locked > img, 
        .project.locked > h3, 
        .project.locked > p { 
            filter: grayscale(100%) brightness(0.5); /* Conteúdo escurecido e cinza */
            transition: filter 0.3s ease; 
        }
        .project.locked .project-lock { 
            display: flex; /* Exibe o overlay da moeda/preço quando trancado */
        }
        .project.locked:hover { 
            transform: translateY(-8px); 
            cursor: pointer; /* Mantém o cursor padrão ou usa um pointer */
        }

        /* Estilos para o estado 'unlocked' do projeto */
        .project.unlocked .project-lock { 
            display: none; /* Esconde o overlay da moeda/preço quando desbloqueado */
        }
        .project.unlocked:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.8), 0 0 15px (255, 215, 0, 0.7); 
            cursor: pointer; 
        }
        
        /* Animação de Shake para cards */
        .project.shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateY(0) translateX(0); } 25% { transform: translateY(-8px) translateX(-5px); } 75% { transform: translateY(-8px) translateX(5px); } }

        /* Controles do jogo */
        #game-controls button {
            position: relative; 
            pointer-events: auto; 
            background-color: #b8860b; 
            color: #121212;
            border: none;
            padding: 0.6rem 1rem; 
            border-radius: 5px;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 0.9rem; 
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            width: fit-content; 
            align-self: flex-end; 
        }

        #game-controls button:hover {
            background-color: #ffd700; 
            transform: translateY(-2px);
        }

        #game-controls button:active {
            transform: translateY(0);
        }

        /* Novo: Efeito de Flash na compra */
        .project-flash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8); /* Flash branco */
            z-index: 3; /* Acima do overlay de bloqueio */
            opacity: 0;
            animation: card-flash 0.6s ease-out forwards; /* Duração curta */
            pointer-events: none;
        }
        @keyframes card-flash {
            0% { opacity: 0; }
            50% { opacity: 1; } /* Ponto de maior brilho */
            100% { opacity: 0; }
        }

        /* Renomeado: Estilo para um sparkle grande individual (192x192px) */
        .individual-super-sparkle { 
            position: absolute; /* Agora posicionado absolutamente dentro de bubble-container */
            width: 128px; 
            height: 128px; 
            background-image: var(--sparkle-spritesheet); 
            background-size: auto 100%; 
            z-index: 4; 
            opacity: 0; 
            pointer-events: none;
            image-rendering: pixelated;
            transform-origin: center; /* Permite rotação em torno do centro */
            will-change: transform, opacity, background-position; /* Otimização de performance */
        }
        
        /* Animação do Spritesheet */
        @keyframes sparkle-animation {
            to { background-position-x: -2304px; } 
        }

        /* Keyframes que combinam subida/movimento para fora, fade e rotação */
        @keyframes combined-sparkle-motion {
            0% { 
                transform: translate(0, 0) rotate(0deg); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; /* Fade-in */
            }
            90% { 
                opacity: 1; 
            }
            100% { 
                transform: translate(var(--sparkle-travel-x, 0), var(--sparkle-travel-y, 0)) rotate(var(--sparkle-final-rotation, 0deg)); 
                opacity: 0; /* Fade-out */
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Cinzel:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="game-background"></div>
    <div id="bubble-container"></div>
    
    <div id="game-controls">
        <div id="coin-balance">
            <span class="coin-icon"></span>
            <span id="coin-count">0</span>
        </div>
        <button id="addCoinsBtn">Add 100 Coins</button>
        <button id="resetProjectsBtn">Reset Projects</button>
    </div>

    <div class="top-bar">
        <span class="name">MATHEUS FRANTZ</span>
        <div class="nav-links">
            <a href="index.html">WORK</a> <span class="separator">/</span> <a href="contact.html">CONTACT</a>
        </div>
    </div>
    <main>
        <section class="intro">
            <h1>Here is some of my work</h1>
            <p>Collect coins to unlock the projects below!</p>
        </section>

        <section class="project-list">
             <a class="project" href="projects/afterlife.html" data-cost="10">
                <div class="project-lock">
                    <span class="project-cost">10</span>
                </div>
                <img src="images/AfterlifeThumb.webp" alt="Afterlife Thumbnail">
                <h3>Afterlife: The Judgement</h3>
                <p>Made using Unity, 2016.</p>
            </a>
            <a class="project" href="projects/project-lua.html" data-cost="15">
                <div class="project-lock">
                    <span class="project-cost">15</span>
                </div>
                <img src="images/LuaThumb.webp" alt="Project L.U.A. Thumbnail">
                <h3>Project L.U.A.</h3>
                <p>Made using Unity, 2017.</p>
            </a>
            <a class="project" href="projects/happy-sheep.html" data-cost="20">
                <div class="project-lock">
                    <span class="project-cost">20</span>
                </div>
                <img src="images/HappySheepThumb.webp" alt="Happy Sheep Thumbnail">
                <h3>Happy Sheep</h3>
                <p>Made using Unity, 2017.</p>
            </a>
            <a class="project" href="projects/heroes-of-metaverse.html" data-cost="25">
                <div class="project-lock">
                    <span class="project-cost">25</span>
                </div>
                <img src="images/AfterlifeThumb.webp" alt="Heroes of Metaverse Thumbnail">
                <h3>Heroes of Metaverse</h3>
                <p>Game Designer, Unity, 2022.</p>
            </a>
            <a class="project" href="projects/clean-castle.html" data-cost="30">
                <div class="project-lock">
                    <span class="project-cost">30</span>
                </div>
                <img src="images/LuaThumb.webp" alt="Clean Castle Thumbnail">
                <h3>Clean Castle</h3>
                <p>Level Designer, Unity, 2022.</p>
            </a>
            <a class="project" href="projects/from-the-main-square.html" data-cost="35">
                <div class="project-lock">
                    <span class="project-cost">35</span>
                </div>
                <img src="images/HappySheepThumb.webp" alt="From the Main Square Thumbnail">
                <h3>From the Main Square</h3>
                <p>Level Designer/Tech Artist, Unity, 2019.</p>
            </a>
        </section>
    </main>
    <footer><p>© Matheus Frantz</p></footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const bubbleContainer = document.getElementById('bubble-container');
    const coinCountElement = document.getElementById('coin-count');
    const projects = document.querySelectorAll('.project');
    const resetProjectsBtn = document.getElementById('resetProjectsBtn'); 
    const addCoinsBtn = document.getElementById('addCoinsBtn'); 

    let coinBalance = 0, unlockedProjects = [], bubbles = [], mouse = { x: -100, y: -100 };
    let lastFrameTime = performance.now();

    let TOP_BOUNDARY = -50; 
    const MAX_BUBBLES = 15; 
    const BUBBLE_INTERVAL = 350; 
    const BOUNCE_DAMPING = 1;
    const HOVER_SCALE = 1.25;
    const MAX_SPEED_X = 3; 
    const MAX_SPEED_Y_BASE = 2; 

    // Coin types constants
    const GOLD_COIN_VALUE = 5;
    const GOLD_COIN_SIZE = 48; 
    const GOLD_COIN_SPEED_MULTIPLIER = 2.0; 

    const SILVER_COIN_VALUE = 2;
    const SILVER_COIN_SIZE_MULTIPLIER = 1.5; // 50% larger than gold
    const SILVER_COIN_SPEED_MULTIPLIER = 1.0; // Same speed as gold (base)
    const SILVER_COIN_CHANCE = 3 / 6; // 5 out of 6 chance for non-gold, meaning 1/6 for gold (before rainbow)

    // NEW: Rainbow Coin Constants
    const RAINBOW_COIN_VALUE = 30; // High value
    const RAINBOW_COIN_SIZE_MULTIPLIER = 1.25; // 25% larger than gold
    const RAINBOW_COIN_SPEED_MULTIPLIER = 3.0; // Faster than gold
    const RAINBOW_COIN_CHANCE = 2 / 10; // 1 in 10 chance for rainbow

    const saveData = () => { localStorage.setItem('mf_coinBalance', coinBalance); localStorage.setItem('mf_unlockedProjects', JSON.stringify(unlockedProjects)); };
    const loadData = () => { coinBalance = parseInt(localStorage.getItem('mf_coinBalance') || '0', 10); unlockedProjects = JSON.parse(localStorage.getItem('mf_unlockedProjects') || '[]'); updateUI(); };
    
    // Função para atualizar a UI dos projetos (travados/destravados)
    const updateUI = () => { 
        coinCountElement.textContent = coinBalance; 
        projects.forEach(p => { 
            const href = p.getAttribute('href'); 
            const isUnlocked = unlockedProjects.includes(href);
            
            p.classList.toggle('locked', !isUnlocked); 
            p.classList.toggle('unlocked', isUnlocked); 

            // Se desbloqueado, remove o filtro
            const img = p.querySelector('img');
            const h3 = p.querySelector('h3');
            const par = p.querySelector('p');

            if (img) img.style.filter = isUnlocked ? 'none' : 'grayscale(100%) brightness(0.5)';
            if (h3) h3.style.filter = isUnlocked ? 'none' : 'grayscale(100%) brightness(0.5)';
            if (par) par.style.filter = isUnlocked ? 'none' : 'grayscale(100%) brightness(0.5)';
        }); 
    };

    if (window.innerWidth <= 768) { 
        const topBarHeight = document.querySelector('.top-bar').offsetHeight;
        TOP_BOUNDARY = topBarHeight; 
    }

    function triggerExplosion(x, y, type = 'gold') { // Added type parameter
        const explosion = document.createElement('div');
        explosion.className = 'sprite-explosion';
        
        let size, animationName;

        switch(type) {
            case 'gray':
                explosion.classList.add('gray');
                size = SILVER_COIN_SIZE_MULTIPLIER * GOLD_COIN_SIZE;
                animationName = 'explode-effect-gray';
                break;
            case 'rainbow': // NEW: Rainbow explosion
                explosion.classList.add('rainbow');
                size = RAINBOW_COIN_SIZE_MULTIPLIER * GOLD_COIN_SIZE;
                animationName = 'explode-effect-rainbow';
                break;
            default: // gold
                size = GOLD_COIN_SIZE;
                animationName = 'explode-effect';
                break;
        }

        explosion.style.width = `${size}px`;
        explosion.style.height = `${size}px`;
        explosion.style.left = `${x}px`;
        explosion.style.top = `${y}px`;
        explosion.style.animation = `${animationName} 0.6s steps(6) forwards`;
        if (type === 'rainbow') {
            explosion.style.animation += ', hue-rotate 0.6s linear forwards';
        }


        bubbleContainer.appendChild(explosion);
        setTimeout(() => {
            explosion.remove();
        }, 600);
    }

    function showScorePop(x, y, value, isButtonPop = false, isError = false) {
        const popElement = document.createElement('div');
        popElement.className = isError ? 'error-pop' : (isButtonPop ? 'button-score-pop' : 'score-pop');
        popElement.textContent = isError ? "Not enough coins!" : `${value > 0 ? '+' : ''}${value}`;
        
        if (isButtonPop) {
            const targetElement = value > 0 ? addCoinsBtn : coinCountElement; 
            const targetRect = targetElement.getBoundingClientRect();
            popElement.style.left = `${targetRect.left + targetRect.width / 2 - popElement.offsetWidth / 2}px`;
            popElement.style.top = `${targetRect.top - 20}px`; 
            document.body.appendChild(popElement); 
        } else if (isError) {
            // CORREÇÃO: Adicionar o scroll da página para posicionamento correto
            popElement.style.left = `${x + window.scrollX - popElement.offsetWidth / 2}px`; 
            popElement.style.top = `${y + window.scrollY - 40}px`; 
            document.body.appendChild(popElement); 
        }
        else {
            popElement.style.left = `${x + 20}px`; 
            popElement.style.top = `${y - 20}px`; 
            bubbleContainer.appendChild(popElement);
        }

        setTimeout(() => {
            popElement.remove();
        }, 1000);
    }

    // Função para animação de desbloqueio de projeto (flash e múltiplos sparkles)
    function animateProjectUnlock(projectElement) {
        // 1. Efeito de Flash
        const flash = document.createElement('div');
        flash.className = 'project-flash';
        projectElement.appendChild(flash); 

        // 2. Múltiplos Super Sparkles
        const numberOfSparkles = 6; // Quantidade de sparkles grandes a criar
        const sparkleDimension = 128; // O tamanho que você configurou para CADA sparkle
        const animationDuration = 1.4; // Duração total da animação em segundos (corresponde ao seu sparkle-animation)

        const projectRect = projectElement.getBoundingClientRect();
        const marginFromEdge = 50; // How many pixels *inside* the edge the sparkle should start

        for (let i = 0; i < numberOfSparkles; i++) {
            const sparkle = document.createElement('div');
            sparkle.className = 'individual-super-sparkle'; 

            let startX, startY;
            let travelX, travelY;

            // Randomly pick one of the four edges
            const edge = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left

            switch (edge) {
                case 0: // Top edge
                    startX = projectRect.left + (Math.random() * (projectRect.width - marginFromEdge * 2)) + marginFromEdge;
                    startY = projectRect.top + marginFromEdge;
                    travelX = (Math.random() - 0.5) * 50; // Some horizontal scatter
                    travelY = - (100 + Math.random() * 50); // Primarily upwards (negative Y for upwards movement)
                    break;
                case 1: // Right edge
                    startX = projectRect.left + projectRect.width - marginFromEdge;
                    startY = projectRect.top + (Math.random() * (projectRect.height - marginFromEdge * 2)) + marginFromEdge;
                    travelX = 100 + Math.random() * 50; // Primarily rightwards
                    travelY = (Math.random() - 0.5) * 50; // Some vertical scatter
                    break;
                case 2: // Bottom edge
                    startX = projectRect.left + (Math.random() * (projectRect.width - marginFromEdge * 2)) + marginFromEdge;
                    startY = projectRect.top + projectRect.height - marginFromEdge;
                    travelX = (Math.random() - 0.5) * 50; // Some horizontal scatter
                    travelY = 100 + Math.random() * 50; // Primarily downwards
                    break;
                case 3: // Left edge
                    startX = projectRect.left + marginFromEdge;
                    startY = projectRect.top + (Math.random() * (projectRect.height - marginFromEdge * 2)) + marginFromEdge;
                    travelX = - (100 + Math.random() * 50); // Primarily leftwards
                    travelY = (Math.random() - 0.5) * 50; // Some vertical scatter
                    break;
            }

            // Adjust for sparkle's own dimension to center its sprite origin at the chosen point
            // This adjustment is relative to the sparkle's position, so it's fine.
            sparkle.style.left = `${startX - sparkleDimension / 2}px`;
            sparkle.style.top = `${startY - sparkleDimension / 2}px`;

            const rotationDegrees = 180 + (Math.random() * -360); 
            const rotationDirection = Math.random() < 0.5 ? 1 : -1; 
            const rotationSpeedMultiplier = (0.5 + Math.random() * 1.5); 

            sparkle.style.setProperty('--sparkle-travel-x', `${travelX}px`);
            sparkle.style.setProperty('--sparkle-travel-y', `${travelY}px`);
            sparkle.style.setProperty('--sparkle-final-rotation', `${rotationDegrees * rotationDirection}deg`);

            sparkle.style.animation = `
                sparkle-animation ${animationDuration}s steps(18) forwards,
                combined-sparkle-motion ${animationDuration / rotationSpeedMultiplier}s ease-out forwards
            `;
            
            sparkle.style.animationDelay = `${i * 0.2}s`; 

            // IMPORTANT: Append sparkle to bubbleContainer (or body) so it's not clipped by project overflow:hidden
            bubbleContainer.appendChild(sparkle);

            // Remove o sparkle após a animação completa
            setTimeout(() => {
                sparkle.remove();
            }, (animationDuration * 1000) + (i * 200) + 100); 
        }

        setTimeout(() => {
            if (flash) flash.remove();
            updateUI(); 
        }, 600); 
    }

    function popBubblesInObstacles() {
        const currentObstacleRects = Array.from(document.querySelectorAll('.project'))
                                            .map(elem => elem.getBoundingClientRect());
        for (const b of [...bubbles]) {
            if (b.clicked) continue;
            const bubbleRect = { left: b.x, right: b.x + b.size, top: b.y, bottom: b.y + b.size };
            for (const rect of currentObstacleRects) {
                if (bubbleRect.right > rect.left && bubbleRect.left < rect.right &&
                    bubbleRect.bottom > rect.top && bubbleRect.top < rect.bottom) {
                    
                    b.clicked = true;
                    b.element.style.display = 'none';
                    triggerExplosion(b.x, b.y, b.type); // Pass the coin type
                    break;
                }
            }
        }
    }

    function createBubble() {
        if (bubbles.length >= MAX_BUBBLES) return;
        
        let type = 'gold';
        let value = GOLD_COIN_VALUE;
        let size = GOLD_COIN_SIZE;
        let speedMultiplier = GOLD_COIN_SPEED_MULTIPLIER;

        // Determine coin type
        const randomChance = Math.random();
        if (randomChance < RAINBOW_COIN_CHANCE) {
            type = 'rainbow';
            value = RAINBOW_COIN_VALUE;
            size = Math.round(GOLD_COIN_SIZE * RAINBOW_COIN_SIZE_MULTIPLIER);
            speedMultiplier = RAINBOW_COIN_SPEED_MULTIPLIER;
        } else if (randomChance < SILVER_COIN_CHANCE) { // This will now be 5/6 - 1/10 = 0.833 - 0.1 = 0.733 chance for silver
            type = 'gray';
            value = SILVER_COIN_VALUE;
            size = Math.round(GOLD_COIN_SIZE * SILVER_COIN_SIZE_MULTIPLIER);
            speedMultiplier = SILVER_COIN_SPEED_MULTIPLIER;
        }
        // else, it defaults to 'gold'

        let initialY;
        let dy; 

        // Randomly decide if it starts from top or bottom
        if (Math.random() < 0.5) { 
            initialY = TOP_BOUNDARY - size; // Start above the top boundary
            dy = (Math.random() * MAX_SPEED_Y_BASE + 0.5) * speedMultiplier; // Move downwards
        } else {
            initialY = window.innerHeight + size; // Start below the bottom of the screen
            dy = (Math.random() * -MAX_SPEED_Y_BASE - 0.5) * speedMultiplier; // Move upwards
        }

        const bubbleElement = document.createElement('div');
        bubbleElement.className = 'coin-sprite';
        bubbleElement.classList.add(type); // Add the type class

        bubbleElement.style.width = `${size}px`;
        bubbleElement.style.height = `${size}px`;

        const bubble = {
            element: bubbleElement,
            x: Math.random() * (window.innerWidth - size), 
            y: initialY,
            dx: (Math.random() - 0.5) * MAX_SPEED_X * 2, 
            dy: dy, 
            size, id: Date.now() + Math.random(), scale: 1, clicked: false, value, type // Store the type
        };

        bubble.element.addEventListener('click', () => {
            if (bubble.clicked) return;
            
            bubble.clicked = true; 
            coinBalance += bubble.value; 
            updateUI();
            showScorePop(bubble.x, bubble.y, bubble.value); 

            bubble.element.style.display = 'none';
            triggerExplosion(bubble.x, bubble.y, bubble.type); // Pass the type here
        });

        bubbles.push(bubble);
        bubbleContainer.appendChild(bubbleElement);
    }

    function gameLoop(currentTime) {
        const deltaTime = Math.min(2, (currentTime - lastFrameTime) / 16.67);
        lastFrameTime = currentTime;

        const currentObstacleRects = Array.from(document.querySelectorAll('.project'))
                                             .map(elem => elem.getBoundingClientRect());

        for (const b of bubbles) { // Iterate directly over bubbles array
            if (b.clicked) continue; // Skip if already clicked
            
            // Update position
            b.x += b.dx * deltaTime;
            b.y += b.dy * deltaTime;
            b.dy += 0.001 * deltaTime; // Apply gravity

            // Boundary checks and bounce
            if (b.x <= 0) { b.x = 0; b.dx *= -BOUNCE_DAMPING; }
            if (b.x + b.size >= window.innerWidth) { b.x = window.innerWidth - b.size; b.dx *= -BOUNCE_DAMPING; }
            
            // Remove if off screen
            if ((b.dy < 0 && b.y + b.size < TOP_BOUNDARY) || (b.dy > 0 && b.y > window.innerHeight + b.size)) {
                b.clicked = true; // Mark for removal
            }

            // Collision with projects
            for (const rect of currentObstacleRects) {
                const bubbleRect = { left: b.x, right: b.x + b.size, top: b.y, bottom: b.y + b.size };
                if (bubbleRect.right > rect.left && bubbleRect.left < rect.right && bubbleRect.bottom > rect.top && bubbleRect.top < rect.bottom) {
                    const minOverlapX = Math.min(bubbleRect.right - rect.left, rect.right - bubbleRect.left);
                    const minOverlapY = Math.min(bubbleRect.bottom - rect.top, rect.bottom - bubbleRect.top);
                    if (minOverlapY < minOverlapX) {
                        b.y += (b.dy > 0) ? -minOverlapY : minOverlapY;
                        b.dy *= -BOUNCE_DAMPING;
                    } else {
                        b.x += (b.dx > 0) ? -minOverlapX : minOverlapX;
                        b.dx *= -BOUNCE_DAMPING;
                    }
                    break; 
                }
            }

            // Hover effect (scaling)
            const distX = mouse.x - (b.x + b.size / 2);
            const distY = mouse.y - (b.y + b.size / 2);
            const distance = Math.sqrt(distX * distX + distY * distY);
            let targetScale = distance < 100 ? HOVER_SCALE : 1; 

            b.scale += (targetScale - b.scale) * 0.1 * deltaTime;

            // Apply transform to element
            b.element.style.transform = `translate(${b.x}px, ${b.y}px) scale(${b.scale})`;
        }

        // Clean up clicked bubbles outside the loop to avoid modifying array while iterating
        const bubblesToRemove = bubbles.filter(b => b.clicked);
        for (const b of bubblesToRemove) {
            if (b.element.parentElement) {
                b.element.remove();
            }
        }
        bubbles = bubbles.filter(b => !b.clicked); // Recreate the bubbles array without the removed ones

        requestAnimationFrame(gameLoop);
    }

    function initialize() {
        loadData();

        let scrollPopTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollPopTimeout);
            scrollPopTimeout = setTimeout(popBubblesInObstacles, 50);
        }, { passive: true });

        setInterval(createBubble, BUBBLE_INTERVAL);
        setInterval(saveData, 5000);
        window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

        projects.forEach(project => {
            project.addEventListener('click', (e) => {
                // If the project is already unlocked, allow normal navigation
                if (project.classList.contains('unlocked')) {
                    return; 
                }

                e.preventDefault(); // Prevent default navigation for locked projects

                const cost = parseInt(project.getAttribute('data-cost'), 10);

                if (coinBalance >= cost) {
                    coinBalance -= cost; 
                    unlockedProjects.push(project.getAttribute('href')); 
                    saveData(); // Save state immediately

                    // Call the new animation function for unlock (flash and sparkles)
                    animateProjectUnlock(project);

                    // Animate -VALUE on user balance
                    showScorePop(0, 0, -cost, true); 
                } else {
                    // Shake animation for insufficient coins
                    project.classList.add('shake'); 
                    setTimeout(() => project.classList.remove('shake'), 500);
                    // NEW: Display "Not enough coins!" message
                    // Pass the click coordinates directly to showScorePop
                    showScorePop(e.clientX, e.clientY, 0, false, true); 
                }
            });
        });

        // Event listener for "Add Coins" button
        addCoinsBtn.addEventListener('click', () => {
            const addedCoins = 100;
            coinBalance += addedCoins;
            updateUI();
            saveData();
            showScorePop(0, 0, addedCoins, true); 
        });

        // Event listener for "Reset Projects" button
        resetProjectsBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset all projects? This will not refund your coins!')) {
                unlockedProjects = [];
                // coinBalance = 0; // Optional: to also reset coins
                saveData();
                updateUI();
            }
        });

        requestAnimationFrame(gameLoop);
    }

    initialize();
});
</script>
</body>
</html>